##### Logging #####

- Rsyslog

	- /etc/rsyslog.conf 		- Main config file
	- /etc/rsyslog.d 			- Additional configs can be placed here
	- /etc/sysconfig/rsyslog 	- rsyslogd startup parameters can be set in this file


	- To specify what information should be logged to which destination, rsyslogd uses
	facilities, priorities, and destinations:
		■ A facility specifies a category of information that is logged. Rsyslogd uses a
		fixed list of facilities, which cannot be extended. This is because of backward
		compatibility with the legacy syslog service.
		■ A priority is used to define the severity of the message that needs to be logged.
		When specifying a priority, by default all messages with that priority and all
		higher priorities are logged.
		■ A destination defines where the message should be written to. Typical desti-
		nations are files, but rsyslog modules can be used as a destination as well, to
		allow further processing through an rsyslogd module.

	- rsyslogd facilities  - Note: The syslog facilities were defined in the 1980s, and to guarantee backward compat-
ibility, no new facilities can be added.

		Facility 			Used by

		auth / authpriv 	Messages related to authentication.
		cron 				Messages generated by the crond service.
		daemon 				Generic facility that can be used for nonspecified daemons.
		kern 				Kernel messages.
		lpr 				Messages generated through the legacy lpd print system.
		mail 				Email-related messages.
		mark 				Special facility that can be used to write a marker periodically.
		news 				Messages generated by the NNTP news system.
		security 			Same as auth / authpriv. Should not be used anymore.
		syslog 				Messages generated by the syslog system.
		user 				Messages generated in user space.
		uucp 				Messages generated by the legacy UUCP system.
		local0-7 			Messages generated by serrvices that are configured by any of the local0 through local7 facilities

	- rsyslogd priorities

		Priority Used for

		debug 				Debug messages that will give as much information as possible about service operation.
		info  				Informational messages about normal service operation.
		notice 				Used for informational messages about items that might become an issue later.
		warning/warn 		Something is suboptimal, but there is no real error yet.
		err/error 			A noncritical error has occurred.
		crit 				A critical error has occurred.
		alert 				Used when the availability of the service is about to be discontinued.
		emerg/panic 		Message generated when the availability of the service is discontinued.

	- rsyslogd facilities and priorities can be found in rsyslog.conf man pages
		# man rsyslog.conf


	- Steps to change httpd loggig from local direct to rsyslog local1 facility:

		- Edit httpd.conf
			ErrorLog	syslog:local1
		- # systemctl restart httpd
		- Edit rsyslog.conf
			local1:error 	-/var/log/httpd-error.log
		- # systemctl restart rsyslog


- Logrotate

	- Default settings are in /etc/logrotate.conf
	- Additional configs can be placed here: /etc/logrotate.d/


- Journalctl

	 On RHEL 7, journald (which is implemented by the systemd-journald daemon)
	provides an advanced log management system. journald collects messages from the
	kernel, the entire boot procedure, and services and writes these messages to an event
	journal. This event journal is stored in a binary format, and it can be queried using
	the journalctl command.

	 By default, the journal stores log data in /run/log/journal/. Since /run/ is volatile, log data is
	lost at reboot. To make the data persistent, it is sufficient to create /var/log/journal/ where
	systemd-journald will then store the data.

	- Persistent journal steps:
		# mkdir /var/log/journal
		# chgrp systemd-journal /var/log/journal
		# chmod 2755 /var/log/journal
		# reboot or systemctl restart systemd-journald

	Note: The information above can be found in "# man systemd-journald.service" man pages

	 Because the journal that is written by journald is not persistent between reboots,
	messages are also forwarded to the rsyslogd service. Rsyslogd writes the messages to
	different files in the /var/log directory. rsyslogd also offers features that do not exist
	in journald, such as centralized logging and filtering messages by using modules.\

	# journalctl -f 						- Tail journal messages
	# journalctl --no-pager					- "Cat" the whole journal to stdout
	# journalctl "then press" TAB twice		- It will display filters
			# journalctl _UID=0				- Display root events only
	# journalctl -o verbose					- Change output to verbose list. Shows every event in a list format with categories.
	# journalctl -p err 					- Show event with err priority only
	# journalctl --since or --until 		- Date from/to filter
	# journalctl --since yesterday -p err 	- Show all err events since yesterday


- Logger

	The logger command enables users to write messages to rsyslog from the command line.

	# logger -p kern.err "Error message" 		- kern is facility and err is priority
